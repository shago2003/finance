<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–§–∏–Ω–∞–Ω—Å—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --bg: #F2F2F7; --card: #FFFFFF; --blue: #007AFF; --text: #000; --gray: #8E8E93; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); margin: 0; padding: 20px; padding-bottom: 90px; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        h1 { font-size: 24px; font-weight: 700; margin: 10px 0 20px 5px; }
        .card { background: var(--card); border-radius: 14px; padding: 0 16px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        
        .row { border-bottom: 1px solid #E5E5EA; padding: 14px 0; display: flex; justify-content: space-between; align-items: center; }
        .row:last-child { border-bottom: none; }
        
        input, select { border: none; font-size: 17px; outline: none; background: transparent; text-align: right; width: 60%; color: var(--blue); font-weight: 500; }
        label { font-size: 16px; }
        
        .btn { width: 100%; padding: 16px; background: var(--blue); color: white; border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .btn:active { opacity: 0.8; transform: scale(0.98); }

        /* –ú–µ–Ω—é —Å–Ω–∏–∑—É */
        .tab-bar { 
            position: fixed; bottom: 20px; left: 20px; right: 20px; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); 
            border-radius: 20px; display: flex; justify-content: space-around; 
            padding: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.15); 
            z-index: 1000; /* –í–ê–ñ–ù–û: –ß—Ç–æ–±—ã –º–µ–Ω—é –±—ã–ª–æ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        }
        .tab-btn { font-size: 26px; opacity: 0.4; cursor: pointer; transition: 0.2s; }
        .tab-btn.active { opacity: 1; transform: scale(1.15); }
        
        .content { display: none; animation: fadeIn 0.2s; }
        .content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="tab-expense" class="content active">
        <h1>üí∏ –†–∞—Å—Ö–æ–¥</h1>
        <div class="card">
            <div class="row"><label>–ü–æ–∫—É–ø–∫–∞</label><input type="text" id="title" placeholder="–ü—Ä–æ–¥—É–∫—Ç—ã"></div>
            <div class="row">
                <label>–°—É–º–º–∞</label>
                <div style="display:flex; justify-content:flex-end; width:100%;">
                    <input type="number" id="price" placeholder="0" style="width:70%;">
                    <select id="curr" style="width:50px;"><option value="AZN">‚Çº</option><option value="RUB">‚ÇΩ</option></select>
                </div>
            </div>
            <div class="row"><label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label><input type="text" id="cat" list="cat_list" placeholder="(–ü—É—Å—Ç–æ)"><datalist id="cat_list"></datalist></div>
        </div>
        <button class="btn" onclick="sendExpense()">–ó–∞–ø–∏—Å–∞—Ç—å</button>
    </div>

    <div id="tab-auto" class="content">
        <h1>üìÖ –ê–≤—Ç–æ-—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
        <p style="color:gray; font-size:13px; margin:-10px 0 15px 5px;">–°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–∞–º–æ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü</p>
        <div class="card">
            <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="auto_name" placeholder="–ò–Ω—Ç–µ—Ä–Ω–µ—Ç"></div>
            <div class="row"><label>–°—É–º–º–∞ (AZN)</label><input type="number" id="auto_price" placeholder="0"></div>
            <div class="row"><label>–î–µ–Ω—å (1-31)</label><input type="number" id="auto_day" placeholder="1"></div>
        </div>
        <button class="btn" onclick="sendAuto()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
        <button class="btn" style="background:white; color:var(--blue); margin-top:15px;" onclick="requestAutoList()">üìú –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>
    </div>

    <div id="tab-cats" class="content">
        <h1>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h1>
        <div class="card">
            <div class="row"><label>–ò–º—è</label><input type="text" id="cat_name"></div>
            <div class="row"><label>–¢–µ–≥–∏</label><input type="text" id="cat_words" placeholder="—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é"></div>
        </div>
        <button class="btn" onclick="sendCategory()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div class="tab-bar">
        <div class="tab-btn active" onclick="switchTab('expense', this)">üí∏</div>
        <div class="tab-btn" onclick="switchTab('auto', this)">üìÖ</div>
        <div class="tab-btn" onclick="switchTab('cats', this)">üìÇ</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        function switchTab(id, el) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            document.getElementById('tab-' + id).classList.add('active');
            
            // –ú–µ–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function sendExpense() {
            let title = document.getElementById('title').value;
            let price = document.getElementById('price').value;
            let curr = document.getElementById('curr').value;
            let cat = document.getElementById('cat').value || "–ü—Ä–æ—á–µ–µ";
            if(!title || !price) return Swal.fire('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è', 'error');
            
            tg.sendData(JSON.stringify({ action: 'add_expense', title: title, price: price, curr: curr, cat: cat }));
        }

        function sendAuto() {
            let name = document.getElementById('auto_name').value;
            let price = document.getElementById('auto_price').value;
            let day = document.getElementById('auto_day').value;
            
            if(!name || !price || !day) return Swal.fire('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
            if(day < 1 || day > 31) return Swal.fire('–û—à–∏–±–∫–∞', '–î–µ–Ω—å –æ—Ç 1 –¥–æ 31', 'error');

            tg.sendData(JSON.stringify({ action: 'add_auto', name: name, price: price, day: day }));
        }

        function requestAutoList() {
            tg.sendData(JSON.stringify({ action: 'show_auto_list' }));
        }

        function sendCategory() {
            let n = document.getElementById('cat_name').value;
            let w = document.getElementById('cat_words').value;
            if(!n) return;
            tg.sendData(JSON.stringify({ action: 'add_category', cat_name: n, words: w.split(',') }));
        }
    </script>
</body>
</html>